<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Timetable</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
</head>
<body>
<div class="container">
    <h1>Room-wise Timetable ({{ day }})</h1>
    <form method="get" action="{{ url_for('view_timetable') }}">
        <label>Select Day:</label>
        <select name="day" onchange="this.form.submit()">
            {% for d in ['Monday','Tuesday','Wednesday','Thursday','Friday','Saturday'] %}
                <option value="{{ d }}" {% if d == day %}selected{% endif %}>{{ d }}</option>
            {% endfor %}
        </select>
    </form>
    <a href="{{ url_for('add_class') }}" class="btn btn-primary my-2">Add Class</a>
    <table class="table table-bordered">
        <thead>
            <tr>
                <th>Room / Slot</th>
                {% for slot in slots %}
                    <th>
                        {% if slot.StartTime.__class__.__name__ == 'timedelta' %}
                            {{ (slot.StartTime.total_seconds() // 3600)|int }}:{{ '%02d' % ((slot.StartTime.total_seconds() % 3600) // 60)|int }}
                            -
                            {{ (slot.EndTime.total_seconds() // 3600)|int }}:{{ '%02d' % ((slot.EndTime.total_seconds() % 3600) // 60)|int }}
                        {% elif slot.StartTime.__class__.__name__ == 'time' %}
                            {{ slot.StartTime.strftime('%H:%M') }} - {{ slot.EndTime.strftime('%H:%M') }}
                        {% else %}
                            {{ slot.StartTime|string|slice(0,5) }} - {{ slot.EndTime|string|slice(0,5) }}
                        {% endif %}
                    </th>
                {% endfor %}
            </tr>
        </thead>
        <tbody>
            {% for room in rooms %}
            <tr>
                <td>{{ room.RoomNumber }}</td>
                {% for slot in slots %}
                    {% set sc = scheduled_lookup.get((room.RoomID, slot.SlotID)) %}
                    <td>
                        {% if sc %}
                            <b>{{ sc.CourseName }}</b><br>
                            Teacher: {{ sc.FirstName }} {{ sc.LastName }}<br>
                            <a href="{{ url_for('edit_schedule', schedule_id=sc['ScheduleID']) }}" class="btn btn-sm btn-warning">Edit</a>
                            <form method="post" action="{{ url_for('delete_schedule', schedule_id=sc['ScheduleID']) }}" style="display:inline;">
                                <button type="submit" class="btn btn-sm btn-danger" onclick="return confirm('Delete this schedule?');">Delete</button>
                            </form>
                        {% else %}
                            <span class="text-success">Free</span>
                        {% endif %}
                    </td>
                {% endfor %}
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
</body>
</html>
